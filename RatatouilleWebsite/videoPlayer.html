<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8">

	<title>Not a recipe</title>
	<link rel="icon" href="./assets/EvenSmallerLogo.png">
	
	<script type="text/javascript">
	</script>
	<style type="text/css">
		canvas { border: 1px solid black; }
	</style>
</head>

<body onload="initialize();">

	<div id="contentDiv">
		<video
			id="mainVideoFrame"
			
		  />
	</div>

  	<script type="text/javascript">
  		"use strict";
	
		{
			var currentVideoIndex = 0;
			var stageNumber;
			var courseConfig;
			var videoList;
			var videoFrame = document.getElementById("mainVideoFrame");
		}
			
		async function readConfig(fileName) {
		
			let url = "./" + fileName;
			
			let response = await fetch(url);
	
			if (response.ok) { // if HTTP-status is 200-299
				courseConfig = await response.json();
			} else {
				alert("HTTP Error while retrieving the course configuration.\n" + response.status);
			}
			
			console.log("JSON from config file:\n");
			console.log(courseConfig);
			
			// extract the appropriate video list
			videoList = courseConfig.stages[stageNumber].videoList;
			
			loadNextVideo();
		}
	
		function goToNextScreen() {
			console.log("goToNextScreen\n");
		//	window.location = "play2.html";
		}
		
		function loadNextVideo() {
			console.log("loadNextVideo\n");
			
			// find next video to play		
			console.log("video index:" + currentVideoIndex);
			
			console.log(videoList);

			let videoFileName = videoList[currentVideoIndex].fileName;
		
			console.log("next video file:" + videoFileName);
		
			videoFrame.setAttribute("src", videoFileName);
		}

		function onendedHandler(event) {
			console.log("onendedHandler\n");
		
			currentVideoIndex++;

			if (currentVideoIndex >= videoList.length) {
				goToNextScreen();
			} else {
				videoFrame.pause();
				loadNextVideo();
			}
		}
		
		function videoLoadedHandler(event) {
			console.log("videoLoadedHandler\n");
			if (currentVideoIndex > 0) {
				videoFrame.play();
			}
		}

		function initialize() {
			console.log("initialize");
		
			// read REST parameters
			const queryString = window.location.search;
			const urlParms = new URLSearchParams(queryString);
			
			// read course config file name and stage to execute
			const configFileName = urlParms.get("config");
			console.log("configFileName: "+configFileName);
			stageNumber = urlParms.get("stage");
			
			// read the course configuration
			readConfig(configFileName);			
	  
			// add video ended handler to the video frame
			videoFrame.addEventListener("ended", onendedHandler);
			videoFrame.addEventListener("loadeddata", videoLoadedHandler);
		};
	
		function playVideo() {
			videoFrame.play();
		};
	
	</script>
    
	<div id="playPauseButtons">
		<button id= "playButton" type="button" onclick="playVideo()">Play</button>
	</div>

  </body>
  </html>
